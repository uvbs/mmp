<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta content="width=device-width,initial-scale=1,user-scalable=no" name="viewport" />
    <title>$CCWX-ARTICLETITLE$</title>
    <link href="//res.wx.qq.com/open/libs/weui/1.0.2/weui.min.css" rel="stylesheet" />
    <link href="//static-files.socialcrmyun.com/lib/layer.mobile/need/layer.css" rel="stylesheet" />
    <link href="//static-files.socialcrmyun.com/css/global-m.css" rel="stylesheet" />
    <link href="/Ju-Modules/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/lib/animate/animate.css" rel="stylesheet" />
    <link href="/WuBuHui/css/wubu.css?v=0.0.1" rel="stylesheet" />
    <link href="/Weixin/ArticleTemplate/css/comm.css?v=20160509" rel="stylesheet" />
    <style>
        .course-detail body {
            background-color: #f0f0f0;
            overflow: auto;
            font-family: 'STHeiti','Microsoft YaHei',Helvetica,Arial,sans-serif;
        }

        .row {
            margin-right: 0px;
            margin-left: 0px;
        }

        label {
            font-weight: normal;
        }

        .top {
            background-color: white;
        }

        .mustinput {
            position: relative;
            top: 4px;
            left: 2px;
            color: red;
        }

        .course-img img {
            width: 100%;
            height: 200px;
        }

        .course-name {
            font-size: 20px;
            margin-left: 10px;
            color: #333;
            font-family: '微软雅黑';
            /*text-overflow: ellipsis;*/
            /*overflow: hidden;*/
            display: -webkit-box;
            -webkit-box-orient: vertical;
            /*-webkit-line-clamp: 1;*/
        }

        .summary {
            margin-top: 10px;
            width: 95%;
        }

        .summary-left {
            width: 60%;
            float: left;
            margin-top: 8px;
        }

        .summary-right {
            width: 40%;
            float: left;
            text-align: center;
        }

        .exam-cer-category {
            width: 100%;
        }

        .summary-content {
            /*height: 50px;*/
            margin-left: 10px;
        }

           .btn-exam {
            background-color: #FF7D00;
            color: white;
            height: 40px;
            font-size: 18px;
            padding-top: 8px;
            padding-left: 12px;
            padding-right: 12px;
            border-radius: 4px;
            width: 90%;
        }

        .btn-exam-top {
            background-color: #FF7D00;
            color: white;
            height: 38px;
            line-height: 38px;
            font-size: 16px;
            border-radius: 5px;
            width: 75%;
            margin-left: 18px;
        }

        .btn-ask {
           background-color: white;
            color: #00B53A;
            height: 40px;
            font-size: 18px;
            padding-top: 8px;
            padding-left: 12px;
            padding-right: 12px;
            border-radius: 5px;
            width: 90%;
            border: 1px solid #00B53A;
        }

        .price {
            font-size: 28px;
            color: #FF7E00;
        }

        .price-icon {
            color: #FF7E00;
            font-size: 16px;
        }

        .pre-price {
            text-decoration: line-through;
            padding-left: 10px;
            color: #C0C0C0;
        }

        .exam-cer-category {
            margin-left: 10px;
        }

        .exam-cer-name-unselect {
            background-color: #EEEDEB;
            color: black;
            height: 30px;
            font-size: 12px;
            padding-top: 6px;
            padding-left: 12px;
            padding-right: 12px;
            border-radius: 5px;
            font-weight: normal;
        }

        .exam-cer-name-select {
            background-color: #FF7D00;
            color: white;
            height: 30px;
            font-size: 12px;
            padding-top: 6px;
            padding-left: 12px;
            padding-right: 12px;
            border-radius: 5px;
            font-weight: normal;
        }

        .exam-cer-category-title {
            font-size: 18px;
            font-weight: bold;
            padding-top: 10px;
            padding-bottom: 10px;
        }

        .split {
            height: 1px;
        }

        .tab {
            background-color: white;
        }

        .course-tab {
            margin-top: 15px;
            min-height: 40px;
            margin-bottom: 10px;
        }

        .course-tab-title-unselect {
            text-align: center;
            font-size: 15px;
            margin-top: 10px;
            border-right: 1px solid #F3F2F1;
            border-bottom: 1px solid #F3F2F1;
            padding-bottom: 10px;
            overflow: hidden;
            font-size: 16px;
        }

        .course-tab-title-select {
            text-align: center;
            font-size: 15px;
            margin-top: 10px;
            border-right: 1px solid #F3F2F1;
            color: #FF7D00;
            border-bottom: 1px solid #FF7D00;
            padding-bottom: 10px;
            overflow: hidden;
            font-size: 16px;
        }

        .tab {
        }

        .course-tab {
        }

        .recommend {
            background-color: white;
            margin-top: 15px;
        }

        .recommend-title {
            font-size: 16px;
            padding-top: 10px;
            padding-bottom: 10px;
            margin-left: 10px;
            color: #333;
        }

        .recommend-list {
            text-align: center;
            margin-left: 10px;
        }

        .recommend-item {
            width: 25%;
            text-align: center;
            padding-right: 10px;
            height: 120px;
            margin-bottom: 10px;
        }

            .recommend-item img {
                max-width: 100%;
                height: 80px;
                width: 100%;
            }

            .recommend-item label {
                color: #428bca;
                word-break: break-all;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }

        .course-detail {
            background-color: white;
            margin-top: 15px;
            padding: 10px 10px 10px 10px;
            margin-bottom:50px;
        }

            .course-detail img {
                width: 100%;
            }

        .course-detail-title {
            font-size: 18px;
            font-weight: bold;
            padding-top: 10px;
            padding-bottom: 10px;
            margin-left: 10px;
        }

        .course-detail-content {
            margin-left: 10px;
            padding: 0px 10px 10px 0px;
            min-height: 10px;
        }

        .bottom {
            position: fixed;
            bottom: 0;
            z-index: 9998;
            width: 100%;
            border-top: 1px solid #EAE4E4;
            background-color: #fff;
        }

        .bottom-left {
            text-align: center;
            float: left;
            width: 50%;
            padding-top: 5px;
        }

        .bottom-right {
            text-align: center;
            float: left;
            width: 50%;
            padding-top: 5px;
        }

        .tip {
            color: #FF7D00;
            font-weight: bold;
            font-size: 20px;
        }

        .course-tab-content {
            display: none;
            padding: 10px;
            padding-left: 8px;
            padding-right: 8px;
            padding-bottom: 10px;
        }
        .tab .course-tab-content img{
            width:100% !important;
        }


      

        .layermchild h3 {
            height: 40px;
        }

        .ask-left {
            text-align: center;
            float: left;
            width: 50%;
        }

        .ask-right {
            text-align: center;
            float: left;
            width: 50%;
        }

        .ask-online {
            background-color: white;
            color: #00B53A;
            height: 40px;
            font-size: 16px;
            padding-top: 8px;
            padding-left: 12px;
            padding-right: 12px;
            border-radius: 5px;
            border: 1px solid #00B53A;
            width: 98%;
        }

            .ask-online img {
                width: 25px;
            }

        .ask-phone {
            background-color: white;
            color: #00B53A;
            height: 40px;
            font-size: 16px;
            padding-top: 8px;
            padding-left: 12px;
            padding-right: 12px;
            border-radius: 5px;
            border: 1px solid #00B53A;
            width: 100%;
        }

            .ask-phone img {
                width: 25px;
            }

            .ask-phone a {
                color: #00B53A;
            }

        .green {
            color: #00B53A;
        }

            .green:link, .green:visited {
                color: #00B53A;
            }

        .course-detail-content img {
            width: 100%;
        }

        .address-img {
            margin-left: 10px;
            margin-top: 3px;
            padding-bottom: 10px;
        }

        .img-icon {
            width: 16px;
            height: 16px;
        }

        .time-img {
            margin-left: 10px;
            margin-top: 8px;
        }

        .pLeft0 {
            padding-left: 0px;
            font-size: 14px;
        }

        .cBlock {
            font-size: 14px;
        }

        .input-group, .confirmsign {
            margin-top: 10px;
        }

        .wcontainer {
            display: none;
        }

        .confirmsign {
            text-align: center;
        }

        .askclass {
            width: 95% !important;
            height: 150px;
            max-width: 500px;
        }

        #lblAmount {
            color: Red;
            font-weight: bold;
        }

        #wrapSelectCoupon .couponList {
            height: 100%;
            position: absolute;
            width: 100%;
            top: 0px;
            padding-top: 50px;
            overflow-y: auto;
            padding-bottom: 20px;
        }

        #wrapSelectCoupon .header {
            position: absolute;
            width: 100%;
            z-index: 10000;
        }

        .divblock {
            display: -webkit-inline-box;
            overflow-x: auto;
        }
        .new-coupons .new-coupon .coupon-content .coupon-left .big-word {
            font-size:15px;
            font-weight:bold;
        }
        .new-coupons .new-coupon .coupon-content .coupon-center .title {
            font-size:14px;
        }
    </style>
</head>
<body>

    <div>

        <div class="top">

            <div class="course-img">
                <img src=" $CCWX-ARTICLEIMAGE$" />
            </div>

            <div class="summary">
                <div class="course-name">
                    $CCWX-ARTICLETITLE$
                </div>

                <div class="summary-content row">
                    <div class="summary-left">

                        $CCWX-WXAMOUNT$

                    </div>
                    <div class="summary-right">
                        <label class="btn-exam-top">我要报名</label>
                    </div>
                </div>
                <div class="row time-img">
                    <div class="col-xs-12 pLeft0">
                        <img src="/img/time-icon.png" class="img-icon" />
                        <span>时间:</span>
                        <span class="cBlock">$CCWX-ARTICLETIME$</span>
                        至
                        <span class="cBlock">$CCWX-ARTICLEENDTIME$</span>
                    </div>
                </div>
                <div class="row address-img">
                    <div class="col-xs-12 pLeft0">
                        <img src="/img/address-icon.png" class="img-icon" />
                        <span>地址:</span>
                        <span class="cBlock">$CCWX-ARTICLEADDRESS$</span>
                    </div>
                </div>


            </div>
            <div class="wcontainer applyactive">
                <div class="applyactiveinbox">
                    <form action="" id="formsignin">
                        <div class="input-group">
                            <span class="input-group-addon">
                                <span class="iconfont icon-b24"></span><span class="mustinput">
                                    *
                                </span>
                            </span>
                            <input type="text" class="form-control" id="txtName" name="Name" placeholder="姓名"
                                   value="" />
                        </div>
                        <div class="input-group">
                            <span class="input-group-addon">
                                <span class="iconfont icon-b47"></span><span class="mustinput">
                                    *
                                </span>
                            </span>
                            <input type="number" class="form-control" id="txtPhone" name="Phone" placeholder="手机号码"
                                   value="" />
                            <input id="hdIsSignIn" name="AutoSignIn" value="0" type="hidden" />
                            <input id="hdShareUserID" name="ShareUserID" value="" type="hidden" />
                            <input id="hdShareID" name="ShareID" value="" type="hidden" />
                        </div>



                    </form>
                    <div class="confirmsign">
                        <span class="btn btn-primary">
                            <span class="text" onclick="SubmitActivityData()">确认报名</span>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab">

            <div class="course-tab row">
                $CCWX-WXTABTITLES$
            </div>

            $CCWX-WXTABCONTENTS$


            <div style="clear: both;"></div>

        </div>







        <div class="recommend">

            <div class="recommend-title">

                <span class="tip">|</span>
                推荐教材

            </div>

            <div class="recommend-list">

               
                <div class="divblock">
                    $CCWX-WXPRODUCTINFOS$
                    <!--<div class="recommend-item" onclick="window.location.href='/customize/shop/index.aspx?v=1.0&ngroute=/productDetail/427557#/productDetail/427557'">

                        <img src="http://open-files.comeoncloud.net/www/hf/jubit/image/20161211/9D08BCCB1ABB4B24A15324A80ED70A0C.jpg" />

                        <label>测试sku证书测试sku证书测试sku证书测试sku证书测试sku证书测试sku证书</label>
                    </div>-->
                  
                </div>



            </div>

            <div style="clear: both;"></div>
        </div>




        $CCWX-ARTICLECONTENTS$





        <div style="margin-bottom: 60px; min-height: 30px;">

        </div>


        <div class="bottom">
            <div class="bottom-left">


                <label class="btn-ask" id="btnAsk">咨询</label>



            </div>
            <div class="bottom-right">
                <label id="btnSumbit" class="btn-exam">我要报名</label>
            </div>

        </div>

        <!-- footerbar -->

        <div id="wrapSelectCoupon">
            <div class="header">
                <i class="iconfont icon-fanhui btnClose" onclick="hideSelectCoupon()"></i>
                <span onclick="hideSelectCoupon()">选择助学券</span>
            </div>

            <div class="noCoupon">
                ——&nbsp;没有可用助学券&nbsp;——
            </div>
            <div class="couponList">
                <div class="wrapCouponTotalCount">可用助学券 (<span class="couponTotalCount">1</span>张)</div>
                <div class="wrapCouponDataList new-coupons">
                    <div class="new-coupon " v-for="item in currCouponList" v-on:click="selectCoupon(item)" v-bind:class="{ 'bglinghtRed': item.checked}">
                        <div class="coupon-type ">
                            {{item.cardcoupon_type_name}}
                        </div>
                        <div class="coupon-content">
                            <div class="coupon-left">
                                {{{item.value_txt}}}
                                <!-- ￥<span class="big-word ">500</span> -->

                            </div>
                            <div class="coupon-center">
                                <div class="title ">{{item.cardcoupon_name}}</div>

                                <div class="desc  ">{{item.limit_txt}}</div>

                                <!-- <div class="time ">2016.2.20-2016.5.19</div> -->
                            </div>
                            <div class="coupon-right">
                                <span class="iconfont icon-xuanze" v-show="item.checked"></span>
                            </div>
                            <div class="clear-both"></div>
                        </div>
                        <div class="coupon-desc ">
                            <span class="left">还有{{item.end_time_diff}}天过期</span>
                            <span class="right">有效期至：{{item.end_time_str}}</span>
                            <div class="clear"></div>
                        </div>

                        <div class="big-white-circle-left"></div>
                        <div class="big-white-circle-right"></div>
                        <div class="small-white-circle-wrap">

                            <div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div><div style="width: 2px;height: 2px;border-radius: 2px;background: #fff;float: left;margin:0 0 0 8px;"></div>

                        </div>
                    </div>
                </div>
            </div>
            <!--<div class="couponBtn">
                <a href="javascript:;" id="btnSelectCoupon" class="btn btn-warning" onclick="hideSelectCoupon()">确定选择</a>
            </div>-->
        </div>






    </div>
    <script src="/WuBuHui/js/jquery.js"></script>
    <script src="//static-files.socialcrmyun.com/lib/vue/2.0/vue.min.js" type="text/javascript"></script>
    <script src="//static-files.socialcrmyun.com/lib/zepto/zepto.min.js" type="text/javascript"></script>
    <script src="//static-files.socialcrmyun.com/Scripts/global-m.js?v=2016111801" type="text/javascript"></script>
    <script src="//static-files.socialcrmyun.com/lib/layer.mobile/layer.m.js" type="text/javascript"></script>
    <script src="//static-files.socialcrmyun.com/lib/lodash/lodash.min.js" type="text/javascript"></script>
    <script src="/Scripts/jquery.form.js" type="text/javascript"></script>
    <script src="/Scripts/Common.js" type="text/javascript"></script>
    <script src="/lib/vue/vue.min.js" type="text/javascript"></script>
    <script src="/lib/la-datePicker/datePicker.js" type="text/javascript"></script>

    <script type="text/javascript">

        var signUpId = '$CCWX-ARTICLSUGID$'; //真实报名活动ID
        var juactivityId = '$CCWX-JUACTIVITYID$'; //主表ID
        var tel = '$CCWX-TEL$';//电话
        var qq = '$CCWX-QQ$';//QQ
        var pageIndex = 1;
        var currCouponList = [];
        var currBuyItemId = 0;
        var currBuyItemAmount = 0;
        var exchangeAmount = 0; //积分兑换金额
        var amountShowName = "余额";
        var vm = new Vue({
            el: 'body',
            data: {
                currCouponList: [],
                currSelectCouponId: ''
            },
            methods: {
                selectCoupon: selectCoupon//选择助学券
            }
        });
        $(function () {

            console.log(tel);
            console.log(qq);

            var recommendlist = $('.recommend-item').length;
            if (recommendlist <= 0) {
                $('.recommend').hide();
            }
            var tabList = $('.course-tab-title-unselect').length;
            if (tabList <= 0) {
                $('.tab').hide();
            }

            LoadSignUpField();
            LoadConfig();
            LoadMyInfo();
            LoadScoreExchangRate();
            setTimeout(function () {
                $.get('/serv/pubapi.ashx?action=VistWxpay', {}, function (data) { }, 'json');
            }, 5000);

            $("#hdIsSignIn").val(GetParm("autosignin"));
            //tab 点击
            $("[data-tab-title-index]").click(function () {

                try {

                    $("[data-tab-title-index]").each(function () {
                        $(this).removeClass("course-tab-title-select");
                        $(this).addClass("course-tab-title-unselect");
                    })


                    $(this).removeClass("course-tab-title-unselect");
                    $(this).addClass("course-tab-title-select");
                    var index = $(this).attr("data-tab-title-index");



                    $("[data-tab-content-index]").each(function () {
                        $(this).hide();
                    });

                    $("[data-tab-content-index='" + index + "']").show();
                } catch (e) {
                    alert(e);
                }

            });

            //我要报名
            $('.btn-exam-top').click(function () {

                $('.wcontainer ').show();
                $('html, body').animate({ scrollTop: 0 }, 'slow');
            });
            $('.btn-exam').click(function () {
                $('.wcontainer ').show();
                $('html, body').animate({ scrollTop: 0 }, 'slow');
            });


            //咨询
            $("#btnAsk").click(function () {
                layer.open({
                    title: [
                      "请选择咨询方式",
                      'margin-top:0px;'

                    ]
              , anim: 'up'
              , content: '<div class="ask"><div class="ask-left"><div class="ask-online"><a class=\"green\" href=\"http://wpa.qq.com/msgrd?v=3&uin=' + qq + '&site=qq&menu=yes\"><img src=\"/customize/Youzheng/images/online.png\"/>在线咨询</a></div></div><div class="ask-right"><div class="ask-phone"><a href="tel:' + tel + '"><img src="/customize/Youzheng/images/phone.png"/>电话咨询</a></div></div></div>'

                });
                $(".layermbox0 .layermchild").addClass("askclass");
            });

            //显示默认tab
            if ($("[data-tab-title-index]").length > 0) {
                $("[data-tab-title-index='1']")[0].click();
            }

            //分享
            $("#sharebtn,#sendtofriendbtn").click(function () {
                $("#sharebg,#sharebox").show();
                $("#sharebox").css({ "top": $(window).scrollTop() })
            });
            $("#followbtn").click(function () {
                $("#sharebg,#followbox").show();
                $("#followbox").css({ "top": $(window).scrollTop() })
            });
            $("#sharebg,#sharebox,#followbox").click(function () {
                $("#sharebg,#sharebox,#followbox").hide();
                $("#sendtofriendbtn,#sharebtn").removeClass("ui-btn-active");
            });
            $(".ui-loader-default").remove();

        });
        //加载积分兑换比例
        function LoadScoreExchangRate() {
            $.ajax({
                type: 'post',
                url: "/serv/api/mall/score.ashx",
                data: { Action: "ExchangeRate" },
                dataType: "json",
                success: function (resp) {

                    exchangeAmount = resp.amount;
                    exchangeScore = resp.score;
                    if (resp.amount == 0 || resp.score == 0) {
                        $("#divscore").hide();
                        $('#wrapScore').hide();
                    }

                }
            });
        }
        //加载积分
        function LoadScore() {
            $.ajax({
                type: 'post',
                url: "/serv/api/user/info.ashx",
                data: { Action: "currentuserinfo" },
                dataType: "json",
                success: function (resp) {
                    myTototalScore = resp.totalscore;
                    myAmount = resp.account_amount;
                    maxUseAmount = myAmount;
                    if (myTototalScore >= 0) {

                        var html = '<div>使用学习值(共有' + myTototalScore + '学习值)</div>';
                        html += '<div><label><input type="checkbox" id="chkUseScore" onclick="CalcAmount()" />可用<span id="lbMaxUseScore" class="colorRed">0</span学习值，抵<span id="lbCanPayMoney" class="colorRed">0</span>元</label></div>';

                        $('.wrapScore').html(html);
                    } else {
                    }

                    if (myAmount >= 0) {
                        var html = '<div>使用' + amountShowName + '(共有' + myAmount + amountShowName + ')</div>';
                        html += '<div><label><input type="checkbox" id="cbUseAmount" onclick="CalcAmount()" />可用<span id="lbMaxUseAmount" class="colorRed">' + maxUseAmount + '</span>' + amountShowName + '，抵<span id="lbAmountCanPayMoney" class="colorRed">' + maxUseAmount + '</span>元</label></div>';
                        $('.wrapUseAmount').html(html);
                    } else {

                    }
                }
            });
        }
        function LoadMyInfo() {
            $.ajax({
                type: 'post',
                url: "/Handler/OpenGuestHandler.ashx",
                data: { Action: "GetADInfos", pageIndex: pageIndex, ActivityId: signUpId },
                dataType: 'json',
                success: function (resp) {
                    $("#btnloadmore").html("显示更多");
                    if (resp.ExObj.length == 0 && pageIndex == 1) {
                        $("#btnloadmore").remove();
                        $("#append").html("<span>暂无报名</span>");
                    }
                    pageIndex++;
                    var html = "";
                    if (resp.Status == 0) {

                        if (resp.ExObj.length == 0) {
                            $("#btnloadmore").html("没有更多");
                            $("#btnloadmore").removeAttr("onclick");
                            return;
                        }

                        $.each(resp.ExObj, function (index, Item) {
                            html += '<div class="listbox">';
                            html += '<span class="wbtn_round">';
                            html += '<img src="' + Item.K1 + '" alt="">';
                            html += '</span><span class="text">' + Item.Name + '</span><span class="time">' + Item.K2 + '</span>';
                            html += ' </div>';
                        });
                        $("#append").before(html);

                    }
                    else {
                        $("#btnloadmore").html("没有更多");
                    }


                }
            });
        };

        //加载配置
        function LoadConfig() {
            $.ajax({
                type: 'post',
                url: "/serv/api/config/get.ashx",
                dataType: "json",
                success: function (resp) {
                    if (resp.result.malll.is_enable_account_amount_pay == true) {
                        amountShowName = resp.result.malll.account_amount_pay_showname;
                        $('.wrapUseAmount').show();
                    }
                    else {
                        $('.wrapUseAmount').hide();
                    }
                    LoadScore();
                }
            });
        }

        //选择卡券
        function selectCoupon(item) {
            for (var i = 0; i < vm.currCouponList.length; i++) {
                if (vm.currCouponList[i].cardcoupon_id != item.cardcoupon_id)
                    vm.currCouponList[i].checked = false;
            };
            item.checked = !item.checked;
            if (item.checked) {
                vm.currSelectCouponId = item.cardcoupon_id;
                $('#btnShowSelectCoupon').html('已选助学券：<span class="colorRed">' + item.cardcoupon_name + '</span>');
            } else {
                vm.currSelectCouponId = '';
                $('#btnShowSelectCoupon').html('您有<span class="colorRed">' + currCouponList.length + '</span>张可用助学券，请选择助学券');
            }
            hideSelectCoupon();
        }

        //加载报名字段
        function LoadSignUpField() {
            $.ajax({
                type: 'post',
                url: "/Handler/OpenGuestHandler.ashx",
                data: { Action: "SignUpDataInfo", signUpId: signUpId, pathname: window.location.pathname },
                dataType: 'json',
                success: function (resp) {
                    var html = "";
                    if (resp.Status == 0) {
                        if (resp.ExInt == 1) {//不显示报名列表
                            $("#divpersionlist").remove();

                        }
                        $.each(resp.ExObj, function (index, item) {

                            switch (item.InputType) {
                                case "combox": //下拉框
                                    html += '<div class="input-group">';
                                    html += '<span class="input-group-addon">' + item.MappingName;
                                    if (item.FieldIsNull == 1) {
                                        html += '<span class="mustinput">*</span>';
                                    }
                                    html += '</span>';
                                    html += '<select class="form-control" name=\"' + item.FieldName + '\">';
                                    for (var i = 0; i < item.Options.split(',').length; i++) {
                                        var optionValue = item.Options.split(',')[i];
                                        html += '<option value=\"' + optionValue + '\">';
                                        html += optionValue;
                                        html += '</option>';
                                    }
                                    html += '</select>';
                                    html += '</div>';
                                    //
                                    break;
                                case "checkbox": //多选框
                                    //
                                    html += '<div class="input-group">';
                                    html += '<span class="input-group-addon">' + item.MappingName;
                                    if (item.FieldIsNull == 1) {
                                        html += '<span class="mustinput">*</span>';
                                    }
                                    html += '</span>';
                                    for (var i = 0; i < item.Options.split(',').length; i++) {
                                        var optionValue = item.Options.split(',')[i];
                                        html += '&nbsp;<input type=\"checkbox\" name=\"' + item.FieldName + '\" value=\"' + optionValue + '\" id=\"cb' + i + '\">';

                                        html += '&nbsp;<label for=\"cb' + i + '\">' + optionValue + '</label>';
                                        html += '<br/>';

                                    }

                                    html += '</div>';
                                    //

                                    break;
                                case "text": //文本框

                                    //
                                    if (item.IsMultiline == "1") {

                                        html += '<div class="input-group w100P">';

                                        html += '<textarea class=\"form-control\" rows=\"5\" type=\"text\" name=\"' + item.FieldName + '\" id=\"' + item.FieldName + '\" value=\"\" placeholder=\"' + item.MappingName + '\" ></textarea>';

                                        html += '</div>';

                                    } else {

                                        html += '<div class="input-group">';
                                        html += '<span class="input-group-addon">' + item.MappingName;

                                        if (item.FieldIsNull == 1) {
                                            html += '<span class="mustinput">*</span>';
                                        }

                                        html += '</span>';


                                        html += '<input class=\"form-control\"  name=\"' + item.FieldName + '\" id=\"' + item.FieldName + '\" placeholder=\"' + item.MappingName + '\" type=\"text\">';

                                        html += '</div>';

                                    }

                                    break;
                                default:
                                    //
                                    if (item.IsMultiline == "1") {

                                        html += '<div class="input-group w100P">';

                                        html += '<textarea class=\"form-control\" rows=\"5\" type=\"text\" name=\"' + item.FieldName + '\" id=\"' + item.FieldName + '\" value=\"\" placeholder=\"' + item.MappingName + '\" ></textarea>';

                                        html += '</div>';

                                    } else {

                                        html += '<div class="input-group">';
                                        html += '<span class="input-group-addon">' + item.MappingName;

                                        if (item.FieldIsNull == 1) {
                                            html += '<span class="mustinput">*</span>';
                                        }

                                        html += '</span>';


                                        html += '<input class=\"form-control\"  name=\"' + item.FieldName + '\" id=\"' + item.FieldName + '\" placeholder=\"' + item.MappingName + '\" type=\"text\">';

                                        html += '</div>';

                                    }
                                    //
                                    break;

                            }




                        })
                        html += '<input id=\"activityID\" type=\"hidden\" value=\"' + signUpId + '\" name=\"ActivityID\" />';

                        //购买选项
                        html += '<div class="wrapBuy input-group">';


                        html += '<div class="wrapBuyItem"></div>';



                        //Coupon
                        html += '<div class="wrapCoupon">';




                        html += '<a id="btnShowSelectCoupon" href="javascript:;" onclick="showSelectCoupon(this)">您有<span class="colorRed">' + currCouponList.length + '</span>张可用助学券，请选择助学券</a>';
                        html += '<sapn id="lbNoSelectCoupon" class="color999">没有可用助学券</sapn>';



                        html += '<div class="wrapScore"></div>';

                        html += '<div><hr/></div>';

                        html += '<div class="wrapUseAmount"></div>';
                        html += '</div>';

                        html += '<div class="wrapAmount">';
                        html += '<span class="input-group-addon">支付金额:&nbsp;';
                        html += '<label id=\"lblAmount\">0</label>元';
                        html += '</span>';
                        html += '</div>';





                        //html += '<div class="wrapAmount">';
                        //html += '<span class="input-group-addon">支付金额:&nbsp;';
                        //html += '<label id=\"lblAmount\">0</label>元';
                        //html += '</span>';
                        //html += '</div>';



                        html += '</div>';


                        $("#formsignin").append(html);//填充报名字段
                        $("#formsignin").append(resp.ExStr);
                        LoadItem();
                        LoadUserData(); //加载个人信息
                    }
                    else {
                        Alert(resp.Msg);
                    }
                }
            });
        };
        function LoadUserData() {
            $.ajax({
                type: 'post',
                url: "/Handler/OpenGuestHandler.ashx",
                data: { Action: "GetCurrentUserInfo" },
                dataType: "json",
                success: function (resp) {
                    if (resp.Status == 1) {
                        isLogin = 1;
                        $("#txtName").val(resp.ExObj.TrueName);
                        $("#txtPhone").val(resp.ExObj.Phone);
                        $("#formsignin").find("input[type='text'],textarea").each(function () {
                            var placeholder = $(this).attr("placeholder");
                            if (placeholder.indexOf("邮箱") >= 0 || placeholder.indexOf("邮件") >= 0 || placeholder.indexOf("email") >= 0 || placeholder.indexOf("Email") >= 0) {
                                $(this).val(resp.ExObj.Email);
                            }
                            if (placeholder.indexOf("公司") >= 0) {
                                $(this).val(resp.ExObj.Company);
                            }
                            if (placeholder.indexOf("职位") >= 0 || placeholder.indexOf("职务") >= 0) {
                                $(this).val(resp.ExObj.Postion);
                            }


                        });

                    }


                }
            });

            $.ajax({
                type: 'post',
                url: "/Serv/API/Common/CheckWebsiteCommRelation.ashx",
                dataType: "json",
                data: { key: 'WXAuthPageMustLogin' },
                success: function (resp) {
                    if (resp.status) {
                        wxAuthPageMustLogin = 1;
                    }
                }
            });
        }
        //报名
        function SubmitActivityData() {
            $("#formsignin").ajaxSubmit({
                url: "/serv/ActivityApiJson.ashx",
                type: "post",
                dataType: "json",
                success: function (resp) {
                    if (resp.Status == 0) {
                        if (isLogin == 1) {
                            //下单
                            AddOrder();
                            //下单
                        }
                        else {
                            alert("报名成功");
                        }
                    }
                    else {

                        alert(resp.Msg);
                    }

                }
            });
            return false;
        };
        //下单
        function AddOrder() {

            var dataModel = {
                Action: "AddActivityOrder",
                ActivityId: signUpId,
                ItemId: currBuyItemId,
                UseScore: getUseScore(),
                UseAmount: getUseAmount(),
                MyCouponId: vm.currSelectCouponId,
                Name: $("#txtName").val(),
                Phone: $('#txtName').val()

            }

            $.ajax({
                type: 'post',
                url: "/Handler/App/WXMallHandler.ashx",
                data: dataModel,
                dataType: "json",
                success: function (resp) {
                    if (resp.Status == 1) {
                        if (parseFloat(resp.ExObj.toString()) > 0) {
                            window.location.href = '/customize/shop/wxpay.aspx?order_id=' + resp.ExStr + '&return_url_success=/App/Cation/Wap/MyActivityLlists.aspx&return_url_fail=/App/Cation/Wap/MyActivityLlists.aspx';
                        }
                        else {
                            alert("支付成功");
                            setTimeout(" window.location.href = '/App/Cation/Wap/MyActivityLlists.aspx';", 2000)

                        }

                    }
                    else {
                        alert(resp.Msg);
                    }

                }
            });
        }

        //加载活动选项
        function LoadItem() {
            $.ajax({
                type: 'post',
                url: "/Handler/Activity/ActivityHandler.ashx",
                data: { Action: "GetActivityItemList", JuActivityId: juactivityId, isFirstItem: 1 },
                dataType: "json",
                success: function (resp) {
                    console.log('buyitem', resp);
                    var html = '';
                    $.each(resp.ExObj, function (index, item) {
                        if (index >= 1) {
                            return false;
                        }
                        if (index == 0) {
                            html += '<div class="buyItem isChecked" onclick="checkItem(this)" data-amount=\"' + item.Amount + '\"  data-id=\"' + item.ItemId + '\">';
                            currBuyItemId = item.ItemId;
                            currBuyItemAmount = item.Amount;
                        } else {
                            html += '<div class="buyItem" onclick="checkItem(this)" data-amount=\"' + item.Amount + '\" data-id=\"' + item.ItemId + '\">';
                        }

                        html += '<div class="amount">￥' + item.Amount + '</div>';

                        if (item.ProductName) {
                            html += '<div class="name">' + item.ProductName + '</div>';
                        }
                        if (item.Description) {
                            html += '<div class="description">' + item.Description + '</div>';
                        }

                        html += '<div class="checkedbg"></div>';
                        html += '<i class="iconfont checkIcon icon-xuanze"></i>';
                        html += '</div>';

                    });


                    $('.wrapBuyItem').html(html);

                    setTimeout(function () {
                        ItemChange();
                        LoadMyCoupon(); //加载我的助学券
                    }, 1000);

                }
            });
        }
        //加载我的助学券
        function LoadMyCoupon() {
            $.ajax({
                type: 'post',
                url: "/serv/api/mall/CardCoupon.ashx",
                data: { Action: "List", is_can_use: 1, cardcoupon_status: 0, amount: currBuyItemAmount },
                dataType: "json",
                success: function (resp) {

                    console.log('LoadMyCoupon', resp.list);

                    if (resp.list) {
                        $('#wrapSelectCoupon .couponList').show();
                        $('#wrapSelectCoupon .noCoupon').hide();
                        $('#btnShowSelectCoupon').show();
                        $('#lbNoSelectCoupon').hide();

                        for (var i = 0; i < resp.list.length; i++) {
                            var cardcoupon = resp.list[i];
                            cardcoupon.checked = false;
                            cardcoupon.end_time_str = new Date(cardcoupon.valid_to_timestamp).format('yyyy-MM-dd');
                            cardcoupon.end_time_diff = LADatePicker.GetDayDiff(cardcoupon.valid_to_timestamp, new Date());

                            switch (cardcoupon.cardcoupon_type) {
                                case 0:
                                    cardcoupon.cardcoupon_type_name = '折扣券';
                                    cardcoupon.value_txt = '<span class="big-word ">' + cardcoupon.discount + '</span>折';
                                    cardcoupon.limit_txt = '使用无金额限制';

                                    break;
                                case 1:
                                    cardcoupon.cardcoupon_type_name = '现金券';
                                    cardcoupon.value_txt = '￥<span class="big-word ">' + cardcoupon.deductible_amount + '</span>';
                                    cardcoupon.limit_txt = '使用无金额限制';

                                    break;
                                case 2:
                                    cardcoupon.cardcoupon_type_name = '免邮券';
                                    cardcoupon.value_txt = '<span class="big-word ">包邮</span>';
                                    cardcoupon.limit_txt = '满' + cardcoupon.freefreight_amount + '元可用';

                                    break;
                                case 3:
                                    cardcoupon.cardcoupon_type_name = '满减券';
                                    cardcoupon.value_txt = '￥<span class="big-word ">' + cardcoupon.buckle_sub_amount + '</span>';
                                    cardcoupon.limit_txt = '满' + cardcoupon.buckle_amount + '元可用';
                                    break;
                            }


                        };

                        currCouponList = resp.list;
                        $('.couponTotalCount').html(currCouponList.length);

                        $('#btnShowSelectCoupon').html('您有<span class="colorRed">' + currCouponList.length + '</span>张可用助学券，请选择助学券');

                        vm.currCouponList = resp.list;
                    } else {
                        $('#wrapSelectCoupon .noCoupon').show();
                        $('#wrapSelectCoupon .couponList').hide();
                        $('#btnShowSelectCoupon').hide();
                        $('#lbNoSelectCoupon').show();
                        vm.currCouponList = [];
                    }

                    // var html = '';
                    // $.each(resp.list, function (index, item) {
                    //     html += '<option value=\"' + item.cardcoupon_id + '\">';
                    //     html += item.cardcoupon_name;
                    //     html += '</option>';
                    // })

                    // $(ddlCoupon).append(html);

                }
            });
        }

        //选项变动
        function ItemChange() {

            //$(ddlUseScore).html("<option value=\"0\">不使用</option><option checked=\"checked\" value=\"" + maxUseScore + "\">" + maxUseScore + "积分</option>");

            $('#chkUseScore').prop('checked', false);

            if (typeof cbUseAmount != 'undefined') {
                cbUseAmount.checked = false;
            }

            //助学券清除
            ClearSelectCoupon();

            CalcAmount();
        }
        //选择状态清除
        function ClearSelectCoupon() {

            if (vm.currCouponList) {
                for (var i = 0; i < vm.currCouponList.length; i++) {
                    vm.currCouponList[i].checked = false;
                };
            };

            vm.currSelectCouponId = '';

            $('#btnShowSelectCoupon').html('您有<span class="colorRed">' + currCouponList.length + '</span>张可用助学券，请选择助学券');
        }
        //获取要使用的积分
        function getUseScore() {
            if ($('#chkUseScore').prop('checked')) {
                return maxUseScore;
            }

            return 0;
        }
        //获取要使用的余额
        function getUseAmount() {


            if ($("#cbUseAmount").prop('checked')) {
                return maxUseAmount;
            }

            return 0;
        }
        //计算应付金额
        function CalcAmount(type) {

            if (currBuyItemId == "") {
                alert("请选择选项");
                $('#chkUseScore').prop('checked', false);
                return false;
            }


            $.ajax({
                type: 'post',
                url: "/Handler/App/WXMallHandler.ashx",
                data: { Action: "CalcActivityPayAmount", ItemId: currBuyItemId, UseScore: getUseScore(), MyCouponId: vm.currSelectCouponId, UseAmount: getUseAmount() },
                dataType: "json",
                success: function (resp) {
                    if (resp.Status == 1) {
                        $(lblAmount).html(resp.ExStr); //计算应付金额

                        //积分选 余额不选
                        if ($('#chkUseScore').get(0).checked && (!$('#cbUseAmount').get(0).checked)) {
                            if (resp.ExStr == "0.00") {
                                maxUseAmount = 0;
                                $('#lbMaxUseAmount').html(maxUseAmount);
                                $('#lbAmountCanPayMoney').html(maxUseAmount);
                            }
                            else {
                                CalcMaxUseAmount(parseFloat(resp.ExStr));

                            }

                        }
                        //积分选 余额不选

                        //积分不选 余额选
                        if ($('#cbUseAmount').get(0).checked && (!$('#chkUseScore').get(0).checked)) {
                            if (resp.ExStr == "0.00") {
                                maxUseScore = 0;
                                $('#lbMaxUseScore').html(maxUseScore);
                                $('#lbCanPayMoney').html(maxUseScore);
                            }
                            else {
                                CalcMaxUseAmount(parseFloat(resp.ExStr));

                            }

                        }


                        if (!$('#chkUseScore').get(0).checked) {
                            CalcMaxUseScore(parseFloat(resp.ExStr));

                        }
                        if (!$('#cbUseAmount').get(0).checked) {
                            CalcMaxUseAmount(parseFloat(resp.ExStr));

                        }

                    }
                    else {

                        alert(resp.Msg);
                        switch (type) {
                            case 0:
                                ClearSelectCoupon();
                                break;

                            default:

                        }

                    }

                }
            });


        }
        //计算最多使用的余额
        function CalcMaxUseAmount(totalAmount) {

            if (myAmount == 0) {
                return;
            }
            if (myAmount >= totalAmount) {
                maxUseAmount = totalAmount;

            }
            if (myAmount < totalAmount) {
                maxUseAmount = myAmount;
            }

            $('#lbMaxUseAmount').html(maxUseAmount);
            $('#lbAmountCanPayMoney').html(maxUseAmount);

        }

        //计算最多使用的积分
        function CalcMaxUseScore(totalAmount) {

            if (exchangeAmount == 0 || exchangeScore == 0) {
                return;
            }
            maxUseScore = Math.ceil(totalAmount / (exchangeAmount / exchangeScore));

            if (myTototalScore < maxUseScore) {
                maxUseScore = myTototalScore;
            }

            //$(ddlUseScore).html("<option value=\"0\">不使用</option><option checked=\"checked\" value=\"" + maxUseScore + "\">" + maxUseScore + "积分</option>");


            $('#lbMaxUseScore').html(maxUseScore);
            $('#lbCanPayMoney').html((maxUseScore * (exchangeAmount / exchangeScore)).toFixed(2));

        }

        function showSelectCoupon(el) {
            $('#wrapSelectCoupon').show();
        }
        function hideSelectCoupon(el) {
            CouponChange();
            $('#wrapSelectCoupon').hide();
        }
        //助学券变动
        function CouponChange() {

            $('#chkUseScore').get(0).checked = false;
            $('#cbUseAmount').get(0).checked = false;
            CalcAmount(0);
        }
    </script>

</body>
</html>
