<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--活动模板(无微信高级认证)-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="format-detection" content="telephone=no" />
    <title>$CCWX-ARTICLETITLE$</title>
    <link href="/Weixin/ArticleTemplate/css/comm.css" rel="stylesheet" />
    <link href="/App/Cation/Wap/Style/styles/css/style.css" rel="stylesheet" type="text/css" />
    <link href="/lib/animate/animate.css" rel="stylesheet" />
    <style type="text/css">
        body
        {
            font-family: "microsoft yahei" ,arial,\5b8b\4f53;
        }
        
        .footer
        {
            padding: 10px 0px 20px 0;
        }
        
        select
        {
            height: 30px;
            width: 100%;
            text-align: left;
        }
        
        input[type="checkbox"]
        {
            width: 20px;
            height: 20px;
            padding: 0 0px 0 0;
        }
        
        .sendinfobox2
        {
            text-align: left;
        }
        
        .sendinfobox2 .mainbtn
        {
            text-align: center;
        }
        #lblAmount
        {
            color: Red;
            font-weight: bold;
        }
        #wrapSelectCoupon .couponBtn
        {
            position: relative;
        }
        #btnSelectCoupon
        {
            display: inline-block;
            height: 40px;
            border-radius: 10px;
            background-color: #f0ad4e;
            color: #FFF;
            font-size: 20px;
            line-height: 40px;
            box-sizing: border-box;
            text-align: center;
            padding: 0 20px;
            border: 1px solid #f0ad4e;
            margin-top: 5px;
            width: 90%;
            bottom: 10px;
        }
        #wrapSelectCoupon .couponBtn
        {
            padding: 2% 2% 2%;
            width: auto;
        }
        .right
        {
            margin-right: 30px;
        }
        .footerbar
        {
            bottom: 0;
            background-color: #fff;
            position: fixed;
            left: 0;
            width: 100%;
            height: 50px;
            z-index: 99;
            box-shadow: 0 0 3px rgba(0,0,0,0.2);
        }
        .col-xs-8
        {
            width: 100%;
        }
        .footerbar .col-xs-8 .wbtn
        {
            margin-top: 2px;
            width: auto;
            height: 46px;
            line-height: 46px;
        }
        .wbtn_line_main
        {
            color: #5a8ece !important;
        }
        .wbtn
        {
            display: inline-block;
            padding: 0 10px;
            border-radius: 10px;
            line-height: 40px;
            width: auto;
            height: 40px;
        }
        .footerbar .col-xs-8
        {
            padding: 0;
            text-align: center;
        }
        a:visited
        {
            color: #5a8ece;
        }
        .wlink, a
        {
            text-decoration: none;
            font-size: 14px;
        }
        select
        {
            border-radius: 5px;
            border: 1px solid #34adbe;
        }
        .maincontext .maincontent
        {
            padding: 10px 10px 5px 10px;
        }

        #wrapSelectCoupon .header {
            height:25px;
        }
        #wrapSelectCoupon .couponList {
            height: 400px !important;
            overflow-y: scroll;
        }
        .new-coupons .new-coupon .coupon-content .coupon-left .big-word {
            font-size: 15px;
            font-weight: bold;
        }
        .new-coupons .new-coupon .coupon-content .coupon-center .title {
            font-size: 14px;
        }


    </style>
</head>
<body>
    <section class="box padding10">
        <header class="header">
            <h1>$CCWX-ARTICLETITLE$</h1>
            <div class="headerinfo">
                <span class="reading">
                    阅读
                    <span class="orange">$CCWX-ARTICLEOPENCOUNT$</span>&nbsp;
                    <!--分享
                    <span class="orange">$CCWX-ARTICLSHARETCOUNT$</span>-->
                </span>
            </div>
        </header>

        <div class="maincontext">
            <div class="maincontent">
                <span class="time">$CCWX-ARTICLETIME$</span>
                <span class="time">$CCWX-ARTICLEENDTIME$</span>
                <span class="adress">$CCWX-ARTICLEADDRESS$</span>
            </div>
        </div>
        <span class="rule">
            <br />$CCWX-ARTICLECONTENT$<br />

            <div class="sendinfobox2" id="formsignin1">

                <form action="" id="formsignin">
                    <input class="textbox" placeholder="姓名(必填)" name="Name" id="txtName" type="text" />
                    <input class="textbox" placeholder="手机(必填)" name="Phone" id="txtPhone" pattern="\d*" type="text" />
                    <input id="hdIsSignIn" name="AutoSignIn" value="0" type="hidden" />
                    <input id="hdShareUserID" name="ShareUserID" value="" type="hidden" />
                    <input id="hdShareID" name="ShareID" value="" type="hidden" />
                </form>
                <div style="text-align: center;">
                <span class="mainbtn submitbtn" onclick="SubmitActivityData()">报名</span>
                </div>
            </div>

            $CCWX-PERSONNELLIST$
            <!-- 可见区域 -->
            $CCWX-VISIBLEAREA$

            <div class="footer">
                <span class="weixinshare green weixinsharebtn">分享给好友</span>
                <span class="weixinshare blue weixinsharebtn">分享到朋友圈</span>
            </div>


            $CCWX-SHAREUSERINFO$
        </span>
    </section>
    <div id="wrapSelectCoupon">
        <div class="header">
            <i class="iconfont icon-fanhui btnClose" onclick="hideSelectCoupon()"></i><span onclick="hideSelectCoupon()">
                选择优惠券</span>
        </div>
        <div class="noCoupon">
            ——&nbsp;没有可用优惠券&nbsp;——
        </div>
        <div class="couponList">
            <div class="wrapCouponTotalCount">
                可用优惠券 (<span class="couponTotalCount">1</span>张)</div>
            <div class="wrapCouponDataList new-coupons">
                <div class="new-coupon " v-for="item in currCouponList" v-on:click="selectCoupon(item)"
                    v-bind:class="{ 'bglinghtRed': item.checked}">
                    <div class="coupon-type ">
                        {{item.cardcoupon_type_name}}
                    </div>
                    <div class="coupon-content">
                        <div class="coupon-left">
                            {{{item.value_txt}}}
                            <!-- ￥<span class="big-word ">500</span> -->
                        </div>
                        <div class="coupon-center">
                            <div class="title ">
                                {{item.cardcoupon_name}}</div>
                            <div class="desc  ">
                                {{item.limit_txt}}</div>
                            <!-- <div class="time ">2016.2.20-2016.5.19</div> -->
                        </div>
                        <div class="coupon-right">
                            <span class="iconfont icon-xuanze" v-show="item.checked"></span>
                        </div>
                        <div class="clear-both">
                        </div>
                    </div>
                    <div class="coupon-desc ">
                        <span class="left">还有{{item.end_time_diff}}天过期</span> <span class="right">有效期至：{{item.end_time_str}}</span>
                        <div class="clear">
                        </div>
                    </div>
                    <div class="big-white-circle-left">
                    </div>
                    <div class="big-white-circle-right">
                    </div>
                    <div class="small-white-circle-wrap">
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                        <div style="width: 2px; height: 2px; border-radius: 2px; background: #fff; float: left;
                            margin: 0 0 0 8px;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="couponBtn">
            <a href="javascript:;" id="btnSelectCoupon" class="mainbtn submitbtn" onclick="hideSelectCoupon()">
                确定选择</a>
        </div>
    </div>
    $CCWX-RELATIONARTICLE$
    <!--$CCWX-OTHERARTICLE$-->
    $CCWX-ARTICLEBOTTOM$
    <div class="footerbar">
        <div class="col-xs-8">
            $CCWX-ACTIVITYISSIGNIN7$
        </div>
    </div>
</body>
<script src="/Scripts/jquery-1.8.2.min.js" type="text/javascript"></script>
<script src="/Scripts/jquery.form.js" type="text/javascript"></script>
<script src="/lib/vue/vue.min.js" type="text/javascript"></script>
<script src="/lib/la-datePicker/datePicker.js" type="text/javascript"></script>
<script src="/Scripts/Common.js" type="text/javascript"></script>
<script src="/Scripts/wxshare/wxshare0.0.1/wxshare.js" type="text/javascript"></script>
<script src="/Plugins/LayerM/layer.m.js" type="text/javascript"></script>


<script type="text/javascript">
    var pageData = {
        currUserOpenId: '$CCWX-currOpenerOpenID$', //当前用户的wxopenId
        currUserId: '$CCWX-currUserID$', //当前用户的userId
        title: '$CCWX-ARTICLETITLE$', //标题
        summary: '$CCWX-ARTICLESUMMARY$', //描述
        shareImgUrl: '$CCWX-ARTICLEIMAGE$', //分享缩略图
        shareUrl: window.location.href, //分享链接
        tempShareId: CreateGUID(),
        preShareId: GetParm('comeonshareid'),
        preShareUserId: '$CCWX-shareUserId$'//分享者id
        //callback: callback
    };

    //if (pageData.preShareUserId == pageData.currUserId) {
    //    pageData.tempShareId = pageData.preShareId;
    //}


</script>

<script type="text/javascript">
    var signUpId = '$CCWX-ARTICLSUGID$'; //真实报名活动ID
    var juactivityId = '$CCWX-JUACTIVITYID$'; //主表ID
    var signUpActivityID = "$CCWX-signUpActivityID$";
    var currUserOrderId = "$CCWX-currUserOrderId$";
    var isSignUp = "$CCWX-ISSIGNUP$"; //是否已经报名标识
    var myTototalScore = 0; //我的剩余积分
    var maxUseScore = 0; //最多使用积分
    var myAmount = 0; //我的余额
    var maxUseAmount = 0; //最多使用余额
    var exchangeAmount = 0; //积分兑换金额
    var exchangeScore = 0; //需要积分
    var pageIndex = 1;
    var currBuyItemId = 0;
    var currBuyItemAmount = 0;
    var currCouponList = [];
    var canUserCouponCount = 0;
    var isLogin = 0;
    var wxAuthPageMustLogin = 0;
    var appLoginUrl = '$CCWX-APPLOGINURL$';
    var amountShowName = "";
    var vm = new Vue({
        el: 'body',
        data: {
            currCouponList: [],
            currSelectCouponId: ''
        },
        methods: {
            selectCoupon: selectCoupon//选择优惠券
        }
    });

    $(function () {

        if (isSignUp == "1") {//已经报名
            $("#formsignin1").remove();

        }

        $("#hdIsSignIn").val(GetParm("autosignin"));
        
        if (pageData.preShareUserId) {
            $('#hdShareUserID').val(pageData.preShareUserId);
        }
        if (pageData.preShareId) {
            $('#hdShareID').val(pageData.preShareId);
        }

        LoadSignUpField(); //加载报名字段

        LoadConfig();

        LoadRPInfo()//加载报名人数列表

        LoadScoreExchangRate(); //加载积分兑换比例

        $("#applyactivebtn").click(function () {

            $('body').scrollTop(20000);

        });
        window.alert = window.Alert = function (msg) {
            layer.open({
                content: msg,
                time: 2
            });
        };

        setTimeout(function () {
            $.get('/serv/pubapi.ashx?action=VistWxpay', {}, function (data) { }, 'json');
        }, 5000);

    });

    function rePay() {
        var signUpActivityID = "$CCWX-signUpActivityID$";
        var currUserOrderId = "$CCWX-currUserOrderId$";

        window.location.href = '/App/Cation/Wap/RemindPay.aspx?activityid=' + signUpActivityID + '&orderId=' + currUserOrderId;

    }





    //报名
    function SubmitActivityData() {

        //        if (isLogin == 0 && wxAuthPageMustLogin == 1) {
        //            GotoLoginPage();
        //            return;
        //        }
        if (currBuyItemId == "") {
            alert("请选择选项");
            return false;
        }
        $("#formsignin").ajaxSubmit({
            url: "/serv/ActivityApiJson.ashx",
            type: "post",
            dataType: "json",
            success: function (resp) {
                if (resp.Status == 0) {
                    if (isLogin == 1) {
                        //下单
                        AddOrder();
                        //下单
                    }
                    else {
                        alert("报名成功");
                    }
                }
                else {

                    alert(resp.Msg);
                }

            }
        });
        return false;
    };

    //获取要使用的积分
    function getUseScore() {
        if ($('#chkUseScore').prop('checked')) {
            return maxUseScore;
        }

        return 0;
    }
    //获取要使用的余额
    function getUseAmount() {


        if ($("#cbUseAmount").prop('checked')) {
            return maxUseAmount;
        }

        return 0;
    }

    //下单
    function AddOrder() {

        var dataModel = {
            Action: "AddActivityOrder",
            ActivityId: signUpId,
            ItemId: currBuyItemId,
            UseScore: getUseScore(),
            UseAmount: getUseAmount(),
            MyCouponId: vm.currSelectCouponId,
            Name: $(txtName).val(),
            Phone: $(txtPhone).val()

        }
        if (dataModel.ItemId == "") {
            alert("请选择选项");
            return false;
        }
        $.ajax({
            type: 'post',
            url: "/Handler/App/WXMallHandler.ashx",
            data: dataModel,
            dataType: "json",
            success: function (resp) {
                if (resp.Status == 1) {
                    if (parseFloat(resp.ExObj.toString()) > 0) {
                        //window.location.href = '/WxPay/WxPay.aspx?OrderId=' + resp.ExStr; //微信支付
                        window.location.href = '/customize/shop/wxpay.aspx?order_id=' + resp.ExStr + '&return_url_success=/App/Cation/Wap/MyActivityLlists.aspx&return_url_fail=/App/Cation/Wap/MyActivityLlists.aspx';
                    }
                    else {

                        alert("支付成功");
                        setTimeout(" window.location.href = '/App/Cation/Wap/MyActivityLlists.aspx';", 2000)
                        //window.location.href = '/App/Cation/Wap/MyActivityLlists.aspx'; //不用调微信支付，直接转到我报名的活动
                    }

                }
                else {
                    alert(resp.Msg);
                }

            }
        });



    }


    //加载报名字段
    function LoadSignUpField() {
        $.ajax({
            type: 'post',
            url: "/Handler/OpenGuestHandler.ashx",
            data: { Action: "SignUpDataInfo", signUpId: signUpId, pathname: window.location.pathname },
            dataType: 'json',
            success: function (resp) {
                var html = "";
                if (resp.Status == 0) {
                    if (resp.ExInt == 1) {//不显示报名列表
                        $("#divpersionlist").remove();

                    }
                    $.each(resp.ExObj, function (index, item) {

                        switch (item.InputType) {
                            case "combox": //下拉框
                                //
                                html += '<div class="input-group">';
                                html += '<span class="input-group-addon">' + item.MappingName + ':';
                                if (item.FieldIsNull == 1) {
                                    html += '<span class="mustinput">*</span>';
                                }
                                html += '</span>';
                                html += '<select class="form-control" name=\"' + item.FieldName + '\">';
                                for (var i = 0; i < item.Options.split(',').length; i++) {
                                    var optionValue = item.Options.split(',')[i];
                                    html += '<option value=\"' + optionValue + '\">';
                                    html += optionValue;
                                    html += '</option>';

                                }
                                html += '</select>';
                                html += '</div><br/>';
                                //
                                break;
                            case "checkbox": //多选框
                                //
                                html += '<div class="input-group">';
                                html += '<span class="input-group-addon">' + item.MappingName + ':';
                                if (item.FieldIsNull == 1) {
                                    html += '<span class="mustinput">*</span>';
                                }
                                html += '</span><br/>';
                                for (var i = 0; i < item.Options.split(',').length; i++) {
                                    var optionValue = item.Options.split(',')[i];
                                    html += '&nbsp;<input type=\"checkbox\" name=\"' + item.FieldName + '\" value=\"' + optionValue + '\" id=\"cb' + i + '\">';

                                    html += '&nbsp;<label for=\"cb' + i + '\">' + optionValue + '</label>';
                                    html += '<br/>';

                                }

                                html += '</div>';
                                //

                                break;
                            case "text": //文本框
                                //
                                if (item.IsMultiline == "1") {

                                    html += '<textarea class=\"form-control\" rows=\"5\" type=\"text\" name=\"' + item.FieldName + '\" id=\"' + item.FieldName + '\" value=\"\" placeholder=\"' + item.MappingName + '\" ></textarea>';

                                } else {
                                    html += '<input class=\"textbox\"  name=\"' + item.FieldName + '\" id=\"' + item.FieldName + '\" placeholder=\"' + item.MappingName + '\" type=\"text\">';

                                }
                                //
                                break;

                            default:
                                //
                                if (item.IsMultiline == "1") {

                                    html += '<textarea class=\"form-control\" rows=\"5\" type=\"text\" name=\"' + item.FieldName + '\" id=\"' + item.FieldName + '\" value=\"\" placeholder=\"' + item.MappingName + '\" ></textarea>';

                                } else {
                                    html += '<input class=\"textbox\"  name=\"' + item.FieldName + '\" id=\"' + item.FieldName + '\" placeholder=\"' + item.MappingName + '\" type=\"text\">';

                                }
                                //
                                break;

                        }




                    })
                    html += '<input id=\"activityID\" type=\"hidden\" value=\"' + signUpId + '\" name=\"ActivityID\" />';

                    //购买选项
                    html += '<div class="wrapBuy input-group" style="width: 91%;">';


                    html += '<div class="wrapBuyItem"></div>';


                    //Coupon
                    html += '<div class="wrapCoupon">';


                    html += '<a id="btnShowSelectCoupon" href="javascript:;" onclick="showSelectCoupon(this)">您有<span class="colorRed">' + currCouponList.length + '</span>张可用优惠券，请选择优惠券</a>';
                    html += '<sapn id="lbNoSelectCoupon" class="color999">没有可用优惠券</sapn>';

                    html += '<div class="wrapScore"></div>';

                    html += '<div><hr/></div>';

                    html += '<div class="wrapUseAmount"></div>';
                    html += '</div>';

                    html += '<div class="wrapAmount">';
                    html += '<span class="input-group-addon">支付金额:&nbsp;';
                    html += '<label id=\"lblAmount\">0</label>元';
                    html += '</span>';
                    html += '</div>';



                    html += '</div>';



                    $("#formsignin").append(html); //填充报名字段
                    $("#formsignin").append(resp.ExStr);
                    LoadUserData(); //加载个人信息

                    LoadItem(); //加载活动选项


                }
                else {
                    Alert(resp.Msg);
                }
            }
        });
    };

    ///加载当前用户信息 如果可用
    function LoadUserData() {
        $.ajax({
            type: 'post',
            url: "/Handler/OpenGuestHandler.ashx",
            data: { Action: "GetCurrentUserInfo" },
            dataType: "json",
            success: function (resp) {
                if (resp.Status == 1) {
                    isLogin = 1;
                    $("#txtName").val(resp.ExObj.TrueName);
                    $("#txtPhone").val(resp.ExObj.Phone);
                    $("#formsignin").find("input[type='text'],textarea").each(function () {
                        var placeholder = $(this).attr("placeholder");
                        if (placeholder.indexOf("邮箱") >= 0 || placeholder.indexOf("邮件") >= 0 || placeholder.indexOf("email") >= 0 || placeholder.indexOf("Email") >= 0) {
                            $(this).val(resp.ExObj.Email);
                        }
                        if (placeholder.indexOf("公司") >= 0) {
                            $(this).val(resp.ExObj.Company);
                        }
                        if (placeholder.indexOf("职位") >= 0 || placeholder.indexOf("职务") >= 0) {
                            $(this).val(resp.ExObj.Postion);
                        }


                    });

                }


            }
        });

        $.ajax({
            type: 'post',
            url: "/Serv/API/Common/CheckWebsiteCommRelation.ashx",
            dataType: "json",
            data: { key: 'WXAuthPageMustLogin' },
            success: function (resp) {
                if (resp.status) {
                    wxAuthPageMustLogin = 1;
                }
            }
        });
    }

    function showSelectCoupon(el) {
        $('#wrapSelectCoupon').show();
    }

    function hideSelectCoupon(el) {
        CouponChange();
        $('#wrapSelectCoupon').hide();
    }

    //选择卡券
    function selectCoupon(item) {
        for (var i = 0; i < vm.currCouponList.length; i++) {
            if (vm.currCouponList[i].cardcoupon_id != item.cardcoupon_id)
                vm.currCouponList[i].checked = false;
        };
        item.checked = !item.checked;
        if (item.checked) {
            vm.currSelectCouponId = item.cardcoupon_id;
            $('#btnShowSelectCoupon').html('已选优惠券：<span class="colorRed">' + item.cardcoupon_name + '</span>');
        } else {
            vm.currSelectCouponId = '';
            $('#btnShowSelectCoupon').html('您有<span class="colorRed">' + currCouponList.length + '</span>张可用优惠券，请选择优惠券');
        }
        console.log('vm.currSelectCouponId', vm.currSelectCouponId);
    }

    function confirmSelectCoupon(el) {
        if (currCouponList.length == 0) {
            $('#wrapSelectCoupon').hide();
            return;
        };
    }


    function checkItem(el) {
        var _this = $(el);
        $('.wrapBuyItem .buyItem').removeClass("isChecked");
        _this.addClass("isChecked");
        currBuyItemId = _this.data('id');
        currBuyItemAmount = _this.data('amount');

        ItemChange();
    }

    //加载活动选项
    function LoadItem() {
        $.ajax({
            type: 'post',
            url: "/Handler/Activity/ActivityHandler.ashx",
            data: { Action: "GetActivityItemList", JuActivityId: juactivityId },
            dataType: "json",
            success: function (resp) {
                console.log('buyitem', resp);
                var html = '';
                $.each(resp.ExObj, function (index, item) {

                    if (index == 0) {
                        html += '<div class="buyItem isChecked" onclick="checkItem(this)" data-amount=\"' + item.Amount + '\"  data-id=\"' + item.ItemId + '\">';
                        currBuyItemId = item.ItemId;
                        currBuyItemAmount = item.Amount;
                    } else {
                        html += '<div class="buyItem" onclick="checkItem(this)" data-amount=\"' + item.Amount + '\" data-id=\"' + item.ItemId + '\">';
                    }

                    html += '<div class="amount">￥' + item.Amount + '</div>';

                    if (item.ProductName) {
                        html += '<div class="name">' + item.ProductName + '</div>';
                    }
                    if (item.Description) {
                        html += '<div class="description">' + item.Description + '</div>';
                    }

                    html += '<div class="checkedbg"></div>';
                    html += '<i class="iconfont checkIcon icon-xuanze"></i>';
                    html += '</div>';

                });

                //$(ddlItem).append(html);

                $('.wrapBuyItem').html(html);

                setTimeout(function () {
                    ItemChange();
                    LoadMyCoupon(); //加载我的优惠券
                }, 1000)

            }
        });
    }


    //加载积分
    function LoadScore() {
        $.ajax({
            type: 'post',
            url: "/serv/api/user/info.ashx",
            data: { Action: "currentuserinfo" },
            dataType: "json",
            success: function (resp) {
                myTototalScore = resp.totalscore;
                myAmount = resp.account_amount;
                maxUseAmount = myAmount;
                if (myTototalScore >= 0) {

                    var html = '<div>使用积分(共有' + myTototalScore + '积分)</div>';
                    html += '<div><label><input type="checkbox" id="chkUseScore" onclick="CalcAmount()" />可用<span id="lbMaxUseScore" class="colorRed">0</span>积分，抵<span id="lbCanPayMoney" class="colorRed">0</span>元</label></div>';

                    $('.wrapScore').html(html);



                } else {
                    //$("#chkUseScore").attr("disabled", "disabled");

                }

                if (myAmount >= 0) {
                    var html = '<div>使用' + amountShowName + '(共有' + myAmount + amountShowName + ')</div>';
                    html += '<div><label><input type="checkbox" id="cbUseAmount" onclick="CalcAmount()" />可用<span id="lbMaxUseAmount" class="colorRed">' + maxUseAmount + '</span>' + amountShowName + '，抵<span id="lbAmountCanPayMoney" class="colorRed">' + maxUseAmount + '</span>元</label></div>';
                    $('.wrapUseAmount').html(html);


                } else {
                    //$("#cbUseAmount").attr("disabled", "disabled");

                }





            }
        });
    }


    //加载配置
    function LoadConfig() {
        $.ajax({
            type: 'post',
            url: "/serv/api/config/get.ashx",
            dataType: "json",
            success: function (resp) {
                if (resp.result.malll.is_enable_account_amount_pay == true) {
                    amountShowName = resp.result.malll.account_amount_pay_showname;
                    $('.wrapUseAmount').show();
                } else {
                    $('.wrapUseAmount').hide();
                }
                LoadScore();






            }
        });
    }
    //加载积分兑换比例
    function LoadScoreExchangRate() {
        $.ajax({
            type: 'post',
            url: "/serv/api/mall/score.ashx",
            data: { Action: "ExchangeRate" },
            dataType: "json",
            success: function (resp) {

                exchangeAmount = resp.amount;
                exchangeScore = resp.score;
                if (resp.amount == 0 || resp.score == 0) {
                    $("#divscore").hide();
                    $('#wrapScore').hide();
                }

            }
        });
    }

    //加载我的优惠券
    function LoadMyCoupon() {
        $.ajax({
            type: 'post',
            url: "/serv/api/mall/CardCoupon.ashx",
            data: { Action: "List", is_can_use: 1, cardcoupon_status: 0, amount: currBuyItemAmount },
            dataType: "json",
            success: function (resp) {

                console.log('LoadMyCoupon', resp.list);

                if (resp.list) {
                    $('#wrapSelectCoupon .couponList').show();
                    $('#wrapSelectCoupon .noCoupon').hide();
                    $('#btnShowSelectCoupon').show();
                    $('#lbNoSelectCoupon').hide();

                    for (var i = 0; i < resp.list.length; i++) {
                        var cardcoupon = resp.list[i];
                        cardcoupon.checked = false;
                        cardcoupon.end_time_str = new Date(cardcoupon.valid_to_timestamp).format('yyyy-MM-dd');
                        cardcoupon.end_time_diff = LADatePicker.GetDayDiff(cardcoupon.valid_to_timestamp, new Date());

                        switch (cardcoupon.cardcoupon_type) {
                            case 0:
                                cardcoupon.cardcoupon_type_name = '折扣券';
                                cardcoupon.value_txt = '<span class="big-word ">' + cardcoupon.discount + '</span>折';
                                cardcoupon.limit_txt = '使用无金额限制';

                                break;
                            case 1:
                                cardcoupon.cardcoupon_type_name = '现金券';
                                cardcoupon.value_txt = '￥<span class="big-word ">' + cardcoupon.deductible_amount + '</span>';
                                cardcoupon.limit_txt = '使用无金额限制';

                                break;
                            case 2:
                                cardcoupon.cardcoupon_type_name = '免邮券';
                                cardcoupon.value_txt = '<span class="big-word ">包邮</span>';
                                cardcoupon.limit_txt = '满' + cardcoupon.freefreight_amount + '元可用';

                                break;
                            case 3:
                                cardcoupon.cardcoupon_type_name = '满减券';
                                cardcoupon.value_txt = '￥<span class="big-word ">' + cardcoupon.buckle_sub_amount + '</span>';
                                cardcoupon.limit_txt = '满' + cardcoupon.buckle_amount + '元可用';
                                break;
                        }


                    };

                    currCouponList = resp.list;
                    $('.couponTotalCount').html(currCouponList.length);

                    $('#btnShowSelectCoupon').html('您有<span class="colorRed">' + currCouponList.length + '</span>张可用优惠券，请选择优惠券');

                    vm.currCouponList = resp.list;
                } else {
                    $('#wrapSelectCoupon .noCoupon').show();
                    $('#wrapSelectCoupon .couponList').hide();
                    $('#btnShowSelectCoupon').hide();
                    $('#lbNoSelectCoupon').show();
                    vm.currCouponList = [];
                }

                // var html = '';
                // $.each(resp.list, function (index, item) {
                //     html += '<option value=\"' + item.cardcoupon_id + '\">';
                //     html += item.cardcoupon_name;
                //     html += '</option>';
                // })

                // $(ddlCoupon).append(html);

            }
        });
    }

    //计算应付金额
    function CalcAmount(type) {

        if (currBuyItemId == "") {
            alert("请选择选项");
            $('#chkUseScore').prop('checked', false);
            return false;
        }

        // if ((!chkUseScore.checked) && (cbUseAmount.checked) && myTototalScore > 0) {
        //     alert("请先选择积分");
        //     cbUseAmount.checked = false;
        //     CalcAmount();
        //     return false;
        // }

        $.ajax({
            type: 'post',
            url: "/Handler/App/WXMallHandler.ashx",
            data: { Action: "CalcActivityPayAmount", ItemId: currBuyItemId, UseScore: getUseScore(), MyCouponId: vm.currSelectCouponId, UseAmount: getUseAmount() },
            dataType: "json",
            success: function (resp) {
                if (resp.Status == 1) {
                    $(lblAmount).html(resp.ExStr); //计算应付金额

                    //积分选 余额不选
                    if (chkUseScore.checked && (!cbUseAmount.checked)) {
                        if (resp.ExStr == "0.00") {
                            maxUseAmount = 0;
                            $('#lbMaxUseAmount').html(maxUseAmount);
                            $('#lbAmountCanPayMoney').html(maxUseAmount);
                        }
                        else {
                            CalcMaxUseAmount(parseFloat(resp.ExStr));

                        }

                    }
                    //积分选 余额不选 

                    //积分不选 余额选
                    if (cbUseAmount.checked && (!chkUseScore.checked)) {
                        if (resp.ExStr == "0.00") {
                            maxUseScore = 0;
                            $('#lbMaxUseScore').html(maxUseScore);
                            $('#lbCanPayMoney').html(maxUseScore);
                        }
                        else {
                            CalcMaxUseAmount(parseFloat(resp.ExStr));

                        }

                    }
                    //积分不选 余额选

                    //                         //积分选 余额选
                    //                       if (cbUseAmount.checked&&(chkUseScore.checked)) {
                    //                        if (resp.ExStr=="0.00") {
                    //                          maxUseScore=0;
                    //                         $('#lbMaxUseScore').html(maxUseScore);
                    //                         $('#lbCanPayMoney').html(maxUseScore);
                    //                         }
                    //                         else {
                    //                            
                    //                         }

                    //                         }
                    //积分选 余额选


                    //                         //积分不选 余额不选
                    //                        if (!cbUseAmount.checked&&(!chkUseScore.checked)) {
                    //                        if (resp.ExStr=="0.00") {
                    //                          maxUseScore=0;
                    //                         $('#lbMaxUseScore').html(maxUseScore);
                    //                         $('#lbCanPayMoney').html(maxUseScore);
                    //                         }
                    //                         else {
                    //                            
                    //                         }

                    //                         }
                    //                         //积分不选 余额不选

                    if (!chkUseScore.checked) {
                        CalcMaxUseScore(parseFloat(resp.ExStr));

                    }
                    if (!cbUseAmount.checked) {
                        CalcMaxUseAmount(parseFloat(resp.ExStr));

                    }


                    //                        if (!(chkUseScore.checked&&cbUseAmount.checked)) {
                    //                        CalcMaxUseScore(parseFloat(resp.ExStr));
                    //                        CalcMaxUseAmount(parseFloat(resp.ExStr));
                    //}

                }
                else {

                    alert(resp.Msg);
                    switch (type) {
                        case 0:
                            ClearSelectCoupon();
                            // $(ddlCoupon).val("");
                            break;

                        default:

                    }

                }

            }
        });


    }

    //计算最多使用的积分
    function CalcMaxUseScore(totalAmount) {

        if (exchangeAmount == 0 || exchangeScore == 0) {
            return;
        }
        maxUseScore = Math.ceil(totalAmount / (exchangeAmount / exchangeScore));

        if (myTototalScore < maxUseScore) {
            maxUseScore = myTototalScore;
        }

        //$(ddlUseScore).html("<option value=\"0\">不使用</option><option checked=\"checked\" value=\"" + maxUseScore + "\">" + maxUseScore + "积分</option>");


        $('#lbMaxUseScore').html(maxUseScore);
        $('#lbCanPayMoney').html((maxUseScore * (exchangeAmount / exchangeScore)).toFixed(2));

    }

    //计算最多使用的余额
    function CalcMaxUseAmount(totalAmount) {

        if (myAmount == 0) {
            return;
        }
        if (myAmount >= totalAmount) {
            maxUseAmount = totalAmount;

        }
        if (myAmount < totalAmount) {
            maxUseAmount = myAmount;
        }

        $('#lbMaxUseAmount').html(maxUseAmount);
        $('#lbAmountCanPayMoney').html(maxUseAmount);

    }


    //优惠券变动
    function CouponChange() {

        chkUseScore.checked = false;
        cbUseAmount.checked = false;
        CalcAmount(0);
    }

    //选择状态清除
    function ClearSelectCoupon() {

        if (vm.currCouponList) {
            for (var i = 0; i < vm.currCouponList.length; i++) {
                vm.currCouponList[i].checked = false;
            };
        };

        vm.currSelectCouponId = '';

        $('#btnShowSelectCoupon').html('您有<span class="colorRed">' + currCouponList.length + '</span>张可用优惠券，请选择优惠券');
    }

    //选项变动
    function ItemChange() {

        //$(ddlUseScore).html("<option value=\"0\">不使用</option><option checked=\"checked\" value=\"" + maxUseScore + "\">" + maxUseScore + "积分</option>");

        $('#chkUseScore').prop('checked', false);

        if (typeof cbUseAmount != 'undefined') {
            cbUseAmount.checked = false;
        }

        //优惠券清除
        ClearSelectCoupon();

        CalcAmount();
    }

    //获取购买选项id
    function getBuyItemId() {

    }

    function LoadRPInfo() {
        $.ajax({
            type: 'post',
            url: "/Handler/OpenGuestHandler.ashx",
            data: { Action: "GetADInfos", pageIndex: pageIndex, ActivityId: signUpId },
            dataType: "json",
            success: function (resp) {
                var html = "";
                if (resp.Status == 0) {
                    if (resp.ExObj == null) {
                        $("#laodmoer").hide();
                        return;
                    }

                    $.each(resp.ExObj, function (index, Item) {
                        html += '<li><img src=\"' + Item.K1 + '\" />' + Item.Name + '<span class=\"times\">' + Item.K2 + '</span></li>';
                    });
                    $("#fenxiang").text(resp.ExInt);
                    $("#append").before(html);
                    if (resp.ExStr == null) {
                        resp.ExStr = "#";
                    }

                    pageIndex++;
                }
                else {
                    $("#laodmoer").hide();
                }
            }
        });
    };

</script>
<script type="text/javascript">


    //var pageData = {
    //    currUserOpenId: '$CCWX-currOpenerOpenID$', //当前用户的wxopenId
    //    currUserId: '$CCWX-currUserID$', //当前用户的userId
    //    title: '$CCWX-ARTICLETITLE$', //标题
    //    summary: '$CCWX-ARTICLESUMMARY$', //描述
    //    shareImgUrl: '$CCWX-ARTICLEIMAGE$', //分享缩略图
    //    shareUrl: window.location.href, //分享链接
    //    tempShareId: CreateGUID(),
    //    preShareId: GetParm('comeonshareid'),
    //    callback: callback
    //};

    var shareCallBackFunc = {
        timeline_s: function () {
            submitShare('timeline_s');
            shareComeplete('$CCWX-JUACTIVITYID$');
        },
        timeline_c: function () {
            //朋友圈分享取消
        },
        message_s: function () {
            //分享给朋友
            submitShare('message_s');
            shareComeplete('$CCWX-JUACTIVITYID$');
        },
        message_c: function () {
            //朋友分享取消
        }
    }

    var processUrl = function (url) {
        url = DelUrlParam(url, 'comeonshareid');
        url = DelUrlParam(url, 'from');
        url = DelUrlParam(url, 'isappinstalled');
        return url;
    }

    var callback = function (data) { }

    var submitShare = function (WxMsgType) {
        var reqData = {
            Action: 'ShareSubmit',
            url: processUrl(pageData.shareUrl),
            shareId: pageData.tempShareId,
            preId: pageData.preShareId,
            userId: pageData.currUserId,
            userWxOpenId: pageData.currUserOpenId,
            wxMsgType: WxMsgType
        }

        //分享到朋友圈
        $.ajax({
            type: 'post',
            url: '/serv/pubapi.ashx',
            data: reqData,
            dataType: 'jsonp',
            success: function (data) {
                pageData.tempShareId = CreateGUID();
            }
        });
    }

    //TODO:Url处理
    //移除原有参数 comeonshareid from isappinstalled
    pageData.shareUrl = processUrl(pageData.shareUrl);
    pageData.shareUrl = pageData.shareUrl + '?comeonshareid=' + pageData.tempShareId;


    wx.ready(function () {
        wxapi.wxshare({
            title: pageData.title,
            desc: pageData.summary,
            link: pageData.shareUrl,
            imgUrl: pageData.shareImgUrl
        }, shareCallBackFunc)
    });
</script>
</html>
