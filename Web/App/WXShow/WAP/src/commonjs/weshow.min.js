define(["jquery"], function (e) {
    function t(t, n, r) {
        this.container = e(t), this.startX = 0, this.startX = 0, this.mainh = this.container.height(), this.msize = this.container.children().length, this.mchange = 0, this.touchcontrol = !0, this.maini = 0, this.maininitstate = 0, this.animacallback = n, r && (this.pagenum = r), this.loadimg(0)
    }

    return t.prototype.init = function () {
        for (var t = this, n = 0; n < t.msize; n++) t.picanimation(n);
        this.classinit(), t.container.children().each(function (t) {
            t += 1, e(this).addClass("listli" + t)
        }), this.picanimation(), t.touchcontrol = !0, this.container.bind("touchstart", function (e) {
            t.startX = e.originalEvent.targetTouches[0].clientX, t.startY = e.originalEvent.targetTouches[0].clientY
        }), this.container.bind("touchmove", function (e) {
            t.touchcontrol && (e.preventDefault(), t.mfun(e))
        }), this.container.bind("touchend", function (e) {
            t.touchcontrol && t.endfun(e)
        }), t.pagenum && this.nextpage(t.pagenum)
    }, t.prototype.mfun = function (t) {
        var n = this;
        t.originalEvent.targetTouches[0].clientX;
        var r = t.originalEvent.targetTouches[0].clientY, i = r - n.startY, o = (n.mainh - Math.abs(i)) / n.mainh;
        o = .85 > o ? .85 : o, .85 == o ? i > 0 && n.maini > 0 ? this.mchange = 1 : 0 > i && n.maini < this.msize - 1 && (this.mchange = 2) : this.mchange = 0, e(".prebox").css({ "-webkit-transform": "translate3d(0px," + i + "px,0px)" }), e(".nextbox").css({ "-webkit-transform": "translate3d(0px," + i + "px,0px)" }), e(".current").css({ "-webkit-transform": "scale(" + o + ") translate3d(0px," + Math.floor(.3 * i) + "px,0px)" })
    }, t.prototype.endfun = function () {
        var t = this;
        switch (this.mchange) {
            case 1:
                e(".prebox").css({
                    "-webkit-transform": "translate3d(0px," + t.mainh + "px,0px)",
                    "-webkit-transition": "all 0.4s ease-out"
                }), e(".current").css({
                    "-webkit-transform": "scale(0.85) translate3d(0px," + Math.floor(.3 * t.mainh) + "px,0px)",
                    "-webkit-transition": "all 0.4s ease-out"
                }), t.touchcontrol = !1, t.maini--;
                break;
            case 2:
                e(".nextbox").css({
                    "-webkit-transform": "translate3d(0px," + -t.mainh + "px,0px)",
                    "-webkit-transition": "all 0.4s ease-out"
                }), e(".current").css({
                    "-webkit-transform": "scale(0.85) translate3d(0px," + Math.floor(.3 * -t.mainh) + "px,0px)",
                    "-webkit-transition": "all 0.4s ease-out"
                }), t.touchcontrol = !1, t.maini++;
                break;
            default:
                e(".prebox").css({
                    "-webkit-transform": "translate3d(0px,0px,0px)",
                    "-webkit-transition": "all 0.2s ease-out"
                }), e(".nextbox").css({
                    "-webkit-transform": "translate3d(0px,0px,0px)",
                    "-webkit-transition": "all 0.2s ease-out"
                }), e(".current").css({
                    "-webkit-transform": "scale(1) translate3d(0px,0px,0px)",
                    "-webkit-transition": "all 0.2s ease-out"
                }), t.touchcontrol = !1
        }
        var n = function () {
            e(".current")[0].removeEventListener("webkitTransitionEnd", n, !1), t.touchcontrol = !0, t.classinit()
        };
        e(".current")[0].addEventListener("webkitTransitionEnd", n, !1)
    }, t.prototype.classinit = function () {
        var t = this, n = this.maini;
        if (t.loadimg(n + 1), t.container.children().each(function (n) {
            e(this).attr("style", "");
            var n = n - t.maini;
            e(this).css({ top: t.mainh * n })
        }), e(".current").removeClass("current"), e(".prebox").removeClass("prebox"), e(".nextbox").removeClass("nextbox"), e(".listli:eq(" + n + ")").addClass("current"), n > 0 && e(".listli:eq(" + (n - 1) + ")").addClass("prebox"), n < this.msize - 1 && e(".listli:eq(" + (n + 1) + ")").addClass("nextbox"), 0 != t.mchange) {
            for (var r = 1; 20 > r; r++) {
                var i = e(".picanimate" + r), o = e(".overanimate" + r);
                i[0] && i.removeClass("picanimate" + r), o[0] && o.removeClass("overanimate" + r)
            }
            t.picanimation(), t.mchange = 0
        }
    }, t.prototype.picanimation = function (e) {
        var t = this, n = e ? e : t.maini;
        t.animacallback(t, n)
    }, t.prototype.animation = function (e, t, n) {
        var r = "picanimate" + t, i = "overanimate" + t, o = "startanimate" + t;
        if (!e.hasClass(o)) return e.addClass(o), "function" == typeof n && n(), void 0;
        e.addClass(r);
        var s = function () {
            e[0].removeEventListener("webkitAnimationEnd", s, !1), e.removeClass(r), e.addClass(i), "function" == typeof n && n()
        };
        e[0].addEventListener("webkitAnimationEnd", s, !1)
    }, t.prototype.nextpage = function (t) {
        var n = this;
        if (n.mchange = 2, t) {
            e(".current").css({ opacity: "0", "-webkit-transition": "all 0.4s ease-out" }), n.touchcontrol = !1, n.maini = t;
            var r = function () {
                e(".current")[0].removeEventListener("webkitTransitionEnd", r, !1), n.touchcontrol = !0, n.classinit()
            };
            e(".current")[0].addEventListener("webkitTransitionEnd", r, !1)
        } else n.endfun()
    }, t.prototype.loadimg = function (t) {
        var n = e(".listli:eq(" + t + ") .img");
        n.attr("style") || n.attr("style", n.attr("data-original"))
    }, t
});