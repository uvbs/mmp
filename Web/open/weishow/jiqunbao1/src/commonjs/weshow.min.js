define(["jquery"],function(t){function i(i,n,a){this.container=t(i),this.startX=0,this.startX=0,this.mainh=this.container.height(),this.msize=this.container.children().length,this.mchange=0,this.touchcontrol=!0,this.maini=0,this.maininitstate=0,this.animacallback=n,a&&(this.pagenum=a),this.loadimg(0),this.loadimg(1)}return i.prototype.init=function(){for(var i=this,n=0;n<i.msize;n++)i.picanimation(n);this.classinit(),i.container.children().each(function(i){i+=1,t(this).addClass("listli"+i)}),this.picanimation(),i.touchcontrol=!0,this.container.bind("touchstart",function(t){i.startX=t.originalEvent.targetTouches[0].clientX,i.startY=t.originalEvent.targetTouches[0].clientY}),this.container.bind("touchmove",function(t){i.touchcontrol&&(t.preventDefault(),i.mfun(t))}),this.container.bind("touchend",function(t){i.touchcontrol&&i.endfun(t)}),i.pagenum&&(this.nextpage(i.pagenum),this.loadimg(i.pagenum))},i.prototype.mfun=function(i){var n=this;i.originalEvent.targetTouches[0].clientX;var a=i.originalEvent.targetTouches[0].clientY,e=a-n.startY,s=(n.mainh-Math.abs(e))/n.mainh;s=.85>s?.85:s,e>50||-50>e?e>0&&n.maini>0?this.mchange=1:0>e&&n.maini<this.msize-1&&(this.mchange=2):this.mchange=0;var r=parseInt(-n.mainh)+e,o=parseInt(n.mainh)+e;t(".prebox").css({"-webkit-transform":"translate3d(0px,"+r+"px,0px)"}),t(".nextbox").css({"-webkit-transform":"translate3d(0px,"+o+"px,0px)"})},i.prototype.endfun=function(){var i=this;switch(this.mchange){case 1:t(".prebox").css({"-webkit-transform":"translate3d(0px,0px,0px)","-webkit-transition":"all 0.4s ease-out"}),t(".current").css({"-webkit-transform":" translate3d(0px,1px,0px)","-webkit-transition":"all 0.4s ease-out"}),i.touchcontrol=!1,i.maini--;break;case 2:t(".nextbox").css({"-webkit-transform":"translate3d(0px,0px,0px)","-webkit-transition":"all 0.4s ease-out"}),t(".current").css({"-webkit-transform":" translate3d(0px,-1px,0px)","-webkit-transition":"all 0.4s ease-out"}),i.touchcontrol=!1,i.maini++;break;default:t(".prebox").css({"-webkit-transform":"translate3d(0px,-"+i.mainh+"px,0px)","-webkit-transition":"all 0.2s ease-out"}),t(".nextbox").css({"-webkit-transform":"translate3d(0px,"+i.mainh+"px,0px)","-webkit-transition":"all 0.2s ease-out"}),t(".current").css({"-webkit-transform":" translate3d(0px,0px,0px)","-webkit-transition":"all 0.2s ease-out"}),i.touchcontrol=!0}var n=function(){t(".current")[0].removeEventListener("webkitTransitionEnd",n,!1),i.touchcontrol=!0,i.classinit()};t(".current")[0].addEventListener("webkitTransitionEnd",n,!1)},i.prototype.classinit=function(){var i=this,n=this.maini;if(i.loadimg(n+1),i.loadimg(n+2),i.loadimg(n+3),t(".current").removeClass("current"),t(".prebox").removeClass("prebox"),t(".nextbox").removeClass("nextbox"),t(".listli:eq("+n+")").addClass("current"),n>0&&t(".listli:eq("+(n-1)+")").addClass("prebox"),n<this.msize-1&&t(".listli:eq("+(n+1)+")").addClass("nextbox"),i.container.children().each(function(){t(this).hasClass("current")?t(this).css({"-webkit-transform":" translate3d(0px,0px,0px)","-webkit-transition":"0s ease-out"}):t(this).hasClass("prebox")?t(this).css({"-webkit-transform":" translate3d(0px,-"+i.mainh+"px,0px)","-webkit-transition":"0s ease-out"}):t(this).hasClass("nextbox")?t(this).css({"-webkit-transform":" translate3d(0px,"+i.mainh+"px,0px)","-webkit-transition":"0s ease-out"}):t(this).css({"-webkit-transform":" translate3d(0px,"+i.mainh+"px,0px)","-webkit-transition":"0s ease-out"})}),0!=i.mchange){for(var a=1;25>a;a++){var e=t(".picanimate"+a),s=t(".overanimate"+a);e[0]&&e.removeClass("picanimate"+a),s[0]&&s.removeClass("overanimate"+a)}i.picanimation(),i.mchange=0}},i.prototype.picanimation=function(t){var i=this,n=t?t:i.maini;i.animacallback(i,n)},i.prototype.animation=function(t,i,n){var a="picanimate"+i,e="overanimate"+i,s="startanimate"+i;if(!t.hasClass(s))return t.addClass(s),"function"==typeof n&&n(),void 0;t.addClass(a);var r=function(){t[0].removeEventListener("webkitAnimationEnd",r,!1),t.removeClass(a),t.addClass(e),"function"==typeof n&&n()};t[0].addEventListener("webkitAnimationEnd",r,!1)},i.prototype.nextpage=function(i){var n=this;if(n.mchange=2,i){t(".current").css({opacity:"0","-webkit-transition":"all 0.4s ease-out"}),n.touchcontrol=!1,n.maini=i;var a=function(){t(".current")[0].removeEventListener("webkitTransitionEnd",a,!1),n.touchcontrol=!0,n.classinit()};t(".current")[0].addEventListener("webkitTransitionEnd",a,!1)}else n.endfun()},i.prototype.loadimg=function(i){var n=t(".listli:eq("+i+") .img");n.attr("style")||n.attr("style",n.attr("data-original"))},i});