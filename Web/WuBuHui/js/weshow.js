define(["jquery"],function(e){function t(t,n,r){this.container=e(t),this.startX=0,this.startX=0,this.mainh=this.container.height(),this.msize=this.container.children().length,this.mchange=0,this.touchcontrol=!0,this.maini=0,this.maininitstate=0,this.animacallback=n,r&&(this.pagenum=r),this.loadimg(0),this.loadimg(1)}return t.prototype.init=function(){var t=this;for(var n=0;n<t.msize;n++)t.picanimation(n);this.classinit(),t.container.children().each(function(t){t+=1,e(this).addClass("listli"+t)}),this.picanimation(),t.touchcontrol=!0,this.container.bind("touchstart",function(e){t.startX=e.originalEvent.targetTouches[0].clientX,t.startY=e.originalEvent.targetTouches[0].clientY}),this.container.bind("touchmove",function(e){if(!t.touchcontrol)return;e.preventDefault(),t.mfun(e)}),this.container.bind("touchend",function(e){if(!t.touchcontrol)return;t.endfun(e)}),t.pagenum&&(this.nextpage(t.pagenum),this.loadimg(t.pagenum))},t.prototype.mfun=function(t){var n=this,r=t.originalEvent.targetTouches[0].clientX,i=t.originalEvent.targetTouches[0].clientY,s=i-n.startY,o=(n.mainh-Math.abs(s))/n.mainh;o=o<.85?.85:o,s>50||s<-50?s>0&&n.maini>0?this.mchange=1:s<0&&n.maini<this.msize-1&&(this.mchange=2):this.mchange=0;var u=parseInt(-n.mainh)+s,a=parseInt(n.mainh)+s;e(".prebox").css({"-webkit-transform":"translate3d(0px,"+u+"px,0px)"}),e(".nextbox").css({"-webkit-transform":"translate3d(0px,"+a+"px,0px)"})},t.prototype.endfun=function(t){var n=this;switch(this.mchange){case 1:e(".prebox").css({"-webkit-transform":"translate3d(0px,0px,0px)","-webkit-transition":"all 0.4s ease-out"}),e(".current").css({"-webkit-transform":" translate3d(0px,1px,0px)","-webkit-transition":"all 0.4s ease-out"}),n.touchcontrol=!1,n.maini--;break;case 2:e(".nextbox").css({"-webkit-transform":"translate3d(0px,0px,0px)","-webkit-transition":"all 0.4s ease-out"}),e(".current").css({"-webkit-transform":" translate3d(0px,-1px,0px)","-webkit-transition":"all 0.4s ease-out"}),n.touchcontrol=!1,n.maini++;break;default:e(".prebox").css({"-webkit-transform":"translate3d(0px,-"+n.mainh+"px,0px)","-webkit-transition":"all 0.2s ease-out"}),e(".nextbox").css({"-webkit-transform":"translate3d(0px,"+n.mainh+"px,0px)","-webkit-transition":"all 0.2s ease-out"}),e(".current").css({"-webkit-transform":" translate3d(0px,0px,0px)","-webkit-transition":"all 0.2s ease-out"}),n.touchcontrol=!0}var r=function(){e(".current")[0].removeEventListener("webkitTransitionEnd",r,!1),n.touchcontrol=!0,n.classinit()};e(".current")[0].addEventListener("webkitTransitionEnd",r,!1)},t.prototype.classinit=function(){var t=this,n=this.maini;t.loadimg(n+1),t.loadimg(n+2),t.loadimg(n+3),e(".current").removeClass("current"),e(".prebox").removeClass("prebox"),e(".nextbox").removeClass("nextbox"),e(".listli:eq("+n+")").addClass("current"),n>0&&e(".listli:eq("+(n-1)+")").addClass("prebox"),n<this.msize-1&&e(".listli:eq("+(n+1)+")").addClass("nextbox"),t.container.children().each(function(n){e(this).hasClass("current")?e(this).css({"-webkit-transform":" translate3d(0px,0px,0px)","-webkit-transition":"0s ease-out"}):e(this).hasClass("prebox")?e(this).css({"-webkit-transform":" translate3d(0px,-"+t.mainh+"px,0px)","-webkit-transition":"0s ease-out"}):e(this).hasClass("nextbox")?e(this).css({"-webkit-transform":" translate3d(0px,"+t.mainh+"px,0px)","-webkit-transition":"0s ease-out"}):e(this).css({"-webkit-transform":" translate3d(0px,"+t.mainh+"px,0px)","-webkit-transition":"0s ease-out"})});if(t.mchange==0)return;for(var r=1;r<25;r++){var i=e(".picanimate"+r),s=e(".overanimate"+r);i[0]&&i.removeClass("picanimate"+r),s[0]&&s.removeClass("overanimate"+r)}t.picanimation(),t.mchange=0},t.prototype.picanimation=function(e){var t=this,n=e?e:t.maini;t.animacallback(t,n)},t.prototype.animation=function(e,t,n){var r=this,i="picanimate"+t,s="overanimate"+t,o="startanimate"+t;if(!e.hasClass(o)){e.addClass(o),typeof n=="function"&&n();return}e.addClass(i);var u=function(){e[0].removeEventListener("webkitAnimationEnd",u,!1),e.removeClass(i),e.addClass(s),typeof n=="function"&&n()};e[0].addEventListener("webkitAnimationEnd",u,!1)},t.prototype.nextpage=function(t){var n=this;n.mchange=2;if(!t)n.endfun();else{e(".current").css({opacity:"0","-webkit-transition":"all 0.4s ease-out"}),n.touchcontrol=!1,n.maini=t;var r=function(){e(".current")[0].removeEventListener("webkitTransitionEnd",r,!1),n.touchcontrol=!0,n.classinit()};e(".current")[0].addEventListener("webkitTransitionEnd",r,!1)}},t.prototype.loadimg=function(t){var n=e(".listli:eq("+t+") .img");n.attr("style")||n.attr("style",n.attr("data-original"))},t});